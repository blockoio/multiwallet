<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>2 of 4 multisig wallet dapp</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>2 of 4 Multisig Wallet Simple DApp</h1>


<h2> Contract Address </h2>

<input type="text" id="serverAddressText" size="20" placeholder="( Put Server IP:PORT )">
<input type="text" id="contractAddressText" size="54" placeholder="( Put Contract Address )"> 
<input type="button" id="contractSetButton" value="Load Contract">
<br><br>
<div id="contractStateDiv">(Contract does not set)</div>


<h2> Payload Generator </h2>

<div class="tab">
  <button class="tablinks" id="b1">Withdraw</button>
  <button class="tablinks" id="b2">Staking</button>
  <button class="tablinks" id="b3">Unstaking</button>
  <button class="tablinks" id="b4">Voting</button>
</div>

<div class="requestarea">

<div class="tabcontent" id="withdrawDiv">
  <table>
    <tr>
      <td width="150">Amount:</td>
      <td><input type="text" id="withdrawAmountText" size="30"></td>
    </tr>
    <tr>
      <td>To Address:</td>
      <td><input type="text" id="withdrawToAddressText" size="52"></td>
    </tr>
  </table>
</div>

<div class="tabcontent" id="stakeAndUnstakeDiv">
  <table>
    <tr>
      <td width="150">Amount:</td>
      <td><input type="text" id="stakeAndUnstakeAmountText" size="30"></td>
  </table>
</div>

<div class="tabcontent" id="voteDiv">
  <table>
    <tr>
      <td width="150">List of BPs:</td>
      <td><textarea id="bpListText" cols="70" rows="13" placeholder="( List up BP keys, separated by newline )"></textarea></td>
    </tr>
  </table>
</div>

<table>
    <tr>
        <th width="150"></th>
        <th width="80"></th>
        <th></th>
      </tr>
  <tr>
    <td td width="150"><input type="button" id="withdrawGenMsgButton" value="Query Gen Msg"></td>
    <td colspan="2"><input type="text" id="withdrawResultText" size="65" placeholder="( query result be generated here )" readonly></textarea> </td>
  </tr>
  <tr>
    <th></th>
    <th>Owner ID</th>
    <th>Signed Message</th>
  </tr>
  <tr>
    <td>1st Owner:</td>
    <td>
      <select id="ownerSelect1">
        <option value="1" selected>1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </td>
    <td><input type="text" id="signedMsgText1" size="65"></td>
  </tr>
  <tr>
    <td>2nd Owner:</td>
    <td>
      <select id="ownerSelect2">
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </td>
    <td><input type="text" id="signedMsgText2" size="65"></td>
  </tr>
  <tr>
    <td><input type="button" id="genRequestPayloadButton" value="Gen Req Payload"></td>
    <td colspan="2"><textarea id="requestResultText" cols="80" rows="5" placeholder="( payload will be generated here )" readonly></textarea></td>
  </tr>
</table>
</div>

<br>
<button id="guideDiv" class="collapsible">Operation Tips</button>
<div class="content">
<h2>Download</h2>
<a href="multisig2of4.lua">Source Code</a>
<br>
<a href="contract.payload">Compiled Payload</a>

<h2> Step </h2>
<ol>
<li> IDE 또는 Cli로 컨트랙트를 Deploy</li>
<li> Deploy된 컨트랙트 주소를 Contract Address란에 입력해 로드</li>
<li> 작업자는 요청 타입을 선택; Withdraw(출금), Staking, Unstaking, Voting </li>
<li> 타입에 따라 상단의 관련 정보를 기입후 'Query Gen Msg' 버튼 클릭 </li>
<li> 생성된 메시지를 2명이상의 Owner에게 전달</li>
<li> Owner들은 해당 결과를 자신의 Key로 서명해 다시 작업자에게 전달 </li>
<li> 2개 이상의 서명을 하단의 Owner ID와 Signed Message에 기입 </li>
<li> 'Gen Req Payload' 버튼 클릭 </li>
<li> 생성된 Payload로 지갑 컨트랙트에 Call, Send Tx</li>
<li> 수행 결과를 아르고 스캔등을 통해 확인</li>
</ol>

<h2>Deploy using Athena IDE</h2>
1. 컨트랙트파일 가져오기 <br>
2. 컴파일 <br>
3. Deploy with args: owner1, owner2, owner3, owner4 <br>

<h2>AergoCli를 이용한 Deploy Hint </h2>

export owner1addr=<i id='o1'></i> 
<br>
export owner2addr=<i id='o2'></i> 
<br>
export owner3addr=<i id='o3'></i> 
<br>
export owner4addr=<i id='o4'></i> 
<br><br>
export ahost={server_ip}
<br><br>
export sender=$(aergocli account import -H $ahost --if {exported_private_key} --password {password})
<br><br>
aergocli account unlock -H $ahost  --address $sender --password {password}
<br><br>
export ctr_payload={contract_payload}
<br><br>
aergocli contract deploy -H $ahost --amount {initial_deposit_amount} --payload $ctr_payload $sender [\"$owner1addr\",\"$owner2addr\",\"$owner3addr\",\"$owner4addr\"]
<br>
</div>
</body>
<script src="main.js"></script>
</html>